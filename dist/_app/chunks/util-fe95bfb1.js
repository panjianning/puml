var X=Object.defineProperty,Y=Object.defineProperties;var Z=Object.getOwnPropertyDescriptors;var b=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var E=(t,e,o)=>e in t?X(t,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[e]=o,_=(t,e)=>{for(var o in e||(e={}))x.call(e,o)&&E(t,o,e[o]);if(b)for(var o of b(e))z.call(e,o)&&E(t,o,e[o]);return t},S=(t,e)=>Y(t,Z(e));import{D as f,S as B,i as Q,s as $,e as T,c as G,a as R,d as v,b as p,a4 as g,g as tt,G as et,W as j,K as ot,v as rt,ag as st,Z as F,R as C,T as D,U as at,ah as nt,V as U}from"./vendor-1110e278.js";import{c as H,e as A,f as M,i as it,h as ct,j as lt,a as ut,k as dt}from"./state-f35017c8.js";const ft=t=>{const e=pt(deflate(unescape(encodeURIComponent(t)))),o=`https://www.plantuml.com/plantuml/png/${e}`,s=`https://www.plantuml.com/plantuml/svg/${e}`;return new Map([["png",o],["svg",s]])};function pt(t){let e="";for(let o=0;o<t.length;o+=3)o+2===t.length?e+=I(t.charCodeAt(o),t.charCodeAt(o+1),0):o+1===t.length?e+=I(t.charCodeAt(o),0,0):e+=I(t.charCodeAt(o),t.charCodeAt(o+1),t.charCodeAt(o+2));return e}function I(t,e,o){const s=t>>2,r=(t&3)<<4|e>>4,l=(e&15)<<2|o>>6,a=o&63;let n="";return n+=m(s&63),n+=m(r&63),n+=m(l&63),n+=m(a&63),n}function m(t){return t<10?String.fromCharCode(48+t):(t-=10,t<26?String.fromCharCode(65+t):(t-=26,t<26?String.fromCharCode(97+t):(t-=26,t===0?"-":t===1?"_":"?")))}const gt=f(void 0);function mt(t){let e,o;return{c(){e=T("div"),o=T("div"),this.h()},l(s){e=G(s,"DIV",{id:!0,class:!0});var r=R(e);o=G(r,"DIV",{id:!0,class:!0}),R(o).forEach(v),r.forEach(v),this.h()},h(){p(o,"id","container"),p(o,"class","flex-1 overflow-auto"),p(e,"id","view"),p(e,"class","p-2 svelte-5ndy2s"),g(e,"error",t[2]),g(e,"outOfSync",t[3])},m(s,r){tt(s,e,r),et(e,o),t[4](o),t[5](e)},p(s,[r]){r&4&&g(e,"error",s[2]),r&8&&g(e,"outOfSync",s[3])},i:j,o:j,d(s){s&&v(e),t[4](null),t[5](null)}}}function ht(t,e,o){let s;ot(t,H,i=>o(9,s=i));let r="",l="",a,n,c=!1,u=!1,d=!0;rt(()=>{H.subscribe(i=>{try{if(a&&i&&(i.updateDiagram||i.autoSync)){if(i.autoSync||st(H,s.updateDiagram=!1,s),o(3,u=!1),d=!0,r===i.code&&l===i.mermaid)return;r=i.code,l=i.mermaid;const y=n.parentElement.scrollTop;delete a.dataset.processed;const W=ft(r);o(0,a.innerHTML=`<img id="canvas" src="${W.get("svg")}">`,a),o(1,n.parentElement.scrollTop=y,n),o(2,c=!1)}else d?d=!1:o(3,u=!0)}catch(y){console.log("view fail",y),o(2,c=!0)}}),gt.subscribe(i=>{typeof i=="undefined"?o(2,c=!1):(o(2,c=!0),console.log("Error: ",i))})});function J(i){F[i?"unshift":"push"](()=>{a=i,o(0,a)})}function K(i){F[i?"unshift":"push"](()=>{n=i,o(1,n)})}return[a,n,c,u,J,K]}class Lt extends B{constructor(e){super();Q(this,e,ht,mt,$,{})}}const wt=30,L=C(f("manual"),D(),"plantumlAutoHistoryMode"),h=C(f([]),D(),"plantumlAutoHistoryStore"),w=C(f([]),D(),"plantumlManualHistoryStore"),O=f([]),bt=at([L,h,w,O],([t,e,o,s],r)=>{r(t==="auto"?e:t==="manual"?o:t==="loader"?s:e)}),yt=t=>{if(t.type==="loader"){O.update(e=>[t,...e]);return}if(t.name=nt(2),t.type!=="auto"){w.update(e=>[t,...e]);return}h.update(e=>(e.length===wt&&e.pop(),[t,...e]))},Et=t=>{(U(L)==="auto"?h:w).update(e=>(U(L)!=="loader"&&(e=e.filter(o=>t&&o.time!=t)),e))},Tt=t=>{const e=U(t?h:w);return e.length>0?JSON.stringify(e[0].state):""},V="code.mmd",k="config.json",_t=t=>V in t,N=async t=>t.truncated?await(await fetch(t.raw_url)).text():t.content,St=async t=>{const[e,o,s,r]=t.split("github.com").pop().split("/"),{html_url:l,files:a,history:n}=await(await fetch(`https://api.github.com/gists/${s}${r?"/"+r:""}`)).json();if(_t(a)){const c=await N(a[V]);let u;k in a&&(u=await N(a[k]));const d=n[0];return{url:`${l}/${d.version}`,code:c,config:u,author:d.user.login,time:new Date(d.committed_at).getTime(),version:d.version.slice(-7)}}else throw"Invalid gist provided"},P=(t,e=t.url)=>{const o=S(_({},A),{code:t.code,loader:{type:"gist",config:{url:e}}});return t.config&&(o.mermaid=t.config),o},vt=async t=>{try{const[e,o,s,r]=t.split("github.com").pop().split("/"),{history:l}=await(await fetch(`https://api.github.com/gists/${s}${r?"/"+r:""}`)).json(),a=[];for(const c of l){const u=await St(c.url).catch(()=>{});u&&a.push(u)}if(a.length===0)throw"Invalid gist provided";a.reverse();const n=P(a.slice(-1).pop(),t);for(const c of a)yt({state:P(c),time:c.time,type:"loader",url:c.url,name:`${c.author} v${c.version}`});return n}catch(e){console.error(e)}},q={gist:vt},Ct=async()=>{const t=new URLSearchParams(window.location.search);let e=A,o,s,r=!1;const l=t.get("code"),a=t.get("config");if(l&&(o=await(await fetch(l)).text(),r=!0),a?s=await(await fetch(a)).text():s=A.mermaid,o)e={code:o,mermaid:s,loader:{type:"files",config:{codeURL:l,configURL:a}}};else for(const[n,c]of t.entries())if(n in q)try{e=await q[n](c),r=!0;break}catch(u){console.error(u)}r&&M(S(_({},e),{autoSync:!0,updateDiagram:!0,updateEditor:!0}))},Dt=()=>{dt(window.location.hash.slice(1))},Ut=()=>{M({updateDiagram:!0})},Gt=async()=>{var t;Dt(),await it("Loading Gist...",Ct().catch(console.error)),Ut(),ct(),await lt(),(t=ut)==null||t.page()};export{Lt as V,bt as a,Tt as b,yt as c,Et as d,gt as e,ft as g,L as h,Gt as i,O as l,Ut as s};
